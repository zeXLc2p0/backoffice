#!/bin/bash
set -euo pipefail

params="${1:-s3://dokku-stack-phi/covid19/scan-study-inbound/scan_return_results.csv}"
output="${2:-s3://dokku-stack-phi/covid19/results-scan-study/{qrcode\}-{birth_date\}-en.pdf}"

docker run \
    --rm \
    --interactive \
    --env=AWS_ACCESS_KEY_ID \
    --env=AWS_SECRET_ACCESS_KEY \
    seattleflu/lab-result-reports:build-6 \
        fill-template \
            --template scan/report-en.tex \
            --params "$params" \
            --output "$output" \
            --filter 'status_code not in ["not-received", "never-tested", "pending"]'
